# Bảng Test Case Quy Trình Giao Dịch

Bảng dưới đây bao phủ các luồng chính của hệ thống giao dịch bao gồm mua hàng, trừ tiền, hoàn tiền, escrow và khiếu nại (dispute) ở mức System Test. Các cột `Round` sẽ được cập nhật sau khi thực thi.

| Test Case ID | Test Case Description | Test Case Procedure | Expected Results | Pre-conditions | Round 1 Test date | Tester | Round 2 Test date | Tester | Round 3 Test date | Tester | Note |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| TC-PUR-001 | Mua hàng thành công với phương thức thanh toán nội bộ | 1. Người mua đăng nhập.<br>2. Chọn sản phẩm còn hàng.<br>3. Nhập địa chỉ hợp lệ và chọn thanh toán ví nội bộ.<br>4. Xác nhận đơn hàng. | Đơn hàng được tạo trạng thái `Pending Payment`; hiển thị mã đơn. | Tài khoản người mua hợp lệ; sản phẩm còn hàng; ví có đủ số dư. |  |  |  |  |  |  |  |
| TC-PUR-002 | Từ chối đăng nhập khi mua | 1. Người dùng nhập sai mật khẩu 5 lần.<br>2. Thử truy cập màn hình mua hàng. | Hệ thống chặn đăng nhập, không cho vào flow mua hàng; thông báo khóa tạm. | Tài khoản tồn tại nhưng bị nhập sai mật khẩu. |  |  |  |  |  |  | Kiểm tra bảo mật đăng nhập |
| TC-PUR-003 | Mua hàng thất bại do hết hàng | 1. Người mua chọn sản phẩm hết hàng.<br>2. Thử đặt mua. | Hệ thống hiển thị lỗi hết hàng, không tạo đơn. | Sản phẩm có tồn kho = 0. |  |  |  |  |  |  |  |
| TC-PUR-004 | Kiểm tra validate địa chỉ giao hàng | 1. Người mua để trống trường địa chỉ.<br>2. Nhấn xác nhận. | Form báo lỗi "Địa chỉ bắt buộc"; không tạo đơn. | Người mua đã đăng nhập. |  |  |  |  |  |  |  |
| TC-PUR-005 | Áp dụng voucher thành công khi mua | 1. Người mua nhập mã giảm giá hợp lệ.<br>2. Xác nhận đơn hàng. | Voucher áp dụng, tổng tiền giảm đúng; đơn hàng `Pending Payment`. | Voucher còn hạn và thỏa điều kiện. |  |  |  |  |  |  |  |
| TC-PUR-006 | Voucher không hợp lệ | 1. Người mua nhập mã đã hết hạn.<br>2. Thử xác nhận. | Thông báo voucher hết hạn; không tạo đơn. | Mã voucher expired trong hệ thống. |  |  |  |  |  |  |  |
| TC-PUR-007 | Tính phí vận chuyển theo tỉnh thành | 1. Người mua chọn tỉnh xa.<br>2. Xác nhận đơn hàng. | Phí vận chuyển được tính đúng theo bảng cước; đơn hàng `Pending Payment`. | Bảng phí vận chuyển được cấu hình. |  |  |  |  |  |  |  |
| TC-PAY-001 | Trừ tiền thành công từ ví nội bộ | 1. Với đơn `Pending Payment`, chọn thanh toán.<br>2. Nhập OTP hợp lệ.<br>3. Xác nhận thanh toán. | Đơn hàng chuyển `Paid`; ví giảm số dư; ghi nhận giao dịch. | Đơn hợp lệ; OTP service hoạt động. |  |  |  |  |  |  |  |
| TC-PAY-002 | Thanh toán thất bại do thiếu số dư | 1. Ví người mua không đủ tiền.<br>2. Thực hiện thanh toán. | Hệ thống báo lỗi thiếu số dư; trạng thái giữ `Pending Payment`. | Ví < giá trị đơn hàng. |  |  |  |  |  |  |  |
| TC-PAY-003 | Gateway timeout | 1. Gửi yêu cầu thanh toán tới cổng.<br>2. Cổng trả timeout. | Đơn chuyển `Payment Pending`; lịch retry tạo; người mua nhận thông báo chờ. | Cấu hình retry hoạt động; đơn `Pending Payment`. |  |  |  |  |  |  |  |
| TC-PAY-004 | Ngăn chặn double charge | 1. Người mua bấm thanh toán 2 lần trong 5 giây.<br>2. Quan sát kết quả. | Chỉ một giao dịch thành công; giao dịch thứ hai bị từ chối là trùng lặp. | Cấu hình idempotency key hoạt động. |  |  |  |  |  |  |  |
| TC-PAY-005 | Xác thực 3DS thất bại | 1. Người mua chọn thanh toán thẻ yêu cầu 3DS.<br>2. Nhập OTP sai quá 3 lần. | Giao dịch bị từ chối; đơn hàng trở lại `Pending Payment`; log vi phạm lưu lại. | Đơn hàng hỗ trợ 3DS; gateway kích hoạt. |  |  |  |  |  |  |  |
| TC-REF-001 | Hoàn tiền toàn phần do hủy đơn trước giao | 1. Đơn ở trạng thái `Paid` chưa giao.<br>2. Người mua hủy đơn.<br>3. Hệ thống gửi yêu cầu hoàn tiền. | Đơn chuyển `Refunded`; tiền hoàn về ví; email xác nhận gửi. | Gateway hoạt động; đơn chưa giao. |  |  |  |  |  |  |  |
| TC-REF-002 | Hoàn tiền thất bại cần retry | 1. Đơn `Paid` cần hoàn tiền.<br>2. Gateway trả lỗi.<br>3. Job retry chạy. | Đơn ở `Refund Pending`; log retry; cảnh báo gửi đội vận hành. | Gateway đang lỗi; job retry cấu hình. |  |  |  |  |  |  |  |
| TC-REF-003 | Hoàn tiền một phần cho đơn giao thiếu | 1. Đơn `Completed` bị thiếu hàng.<br>2. CS tạo hoàn tiền 30%.<br>3. Xác nhận. | Đơn chuyển `Partial Refunded`; người mua nhận 30%; seller nhận thông báo. | Khiếu nại được phê duyệt; hỗ trợ partial refund. |  |  |  |  |  |  |  |
| TC-REF-004 | Từ chối hoàn tiền do quá hạn | 1. Người mua yêu cầu hoàn tiền sau 45 ngày.<br>2. CS xem xét. | Yêu cầu bị từ chối; trạng thái đơn giữ nguyên; thông báo lý do cho người mua. | Chính sách chỉ hỗ trợ trong 30 ngày. |  |  |  |  |  |  |  |
| TC-REF-005 | Hoàn tiền từ ví escrow sang ví người mua | 1. Đơn ở `In Escrow` bị hủy.<br>2. Hệ thống kích hoạt hoàn tiền. | Tiền chuyển từ tài khoản ký quỹ về ví người mua; đơn `Refunded`. | Tài khoản escrow có đủ tiền. |  |  |  |  |  |  |  |
| TC-ESC-001 | Tạo escrow khi thanh toán dịch vụ | 1. Người mua chọn dịch vụ hỗ trợ escrow.<br>2. Thanh toán thành công. | Đơn `In Escrow`; số tiền ghi nhận ở tài khoản ký quỹ. | Cấu hình escrow hoạt động. |  |  |  |  |  |  |  |
| TC-ESC-002 | Giải phóng escrow sau xác nhận bàn giao | 1. Người bán đánh dấu hoàn tất.<br>2. Người mua xác nhận.<br>3. Hệ thống release tiền. | Escrow giải phóng; đơn `Completed`; seller nhận tiền. | Đơn `In Escrow`; buyer xác nhận. |  |  |  |  |  |  |  |
| TC-ESC-003 | Người mua từ chối bàn giao | 1. Seller đánh dấu hoàn tất.<br>2. Buyer chọn "Không chấp nhận".<br>3. Tạo dispute tự động. | Đơn chuyển `Dispute Open`; tiền vẫn giữ escrow. | Escrow active; dispute module hoạt động. |  |  |  |  |  |  |  |
| TC-ESC-004 | Tự động giải phóng escrow sau SLA | 1. Đơn `In Escrow` không có phản hồi 7 ngày.<br>2. Job cron chạy. | Hệ thống auto release; đơn `Completed`; thông báo gửi hai bên. | SLA auto-release cấu hình; không có dispute mở. |  |  |  |  |  |  |  |
| TC-ESC-005 | Gia hạn escrow theo yêu cầu người mua | 1. Buyer gửi yêu cầu gia hạn.<br>2. CS phê duyệt.<br>3. Hệ thống cập nhật deadline. | Thời gian escrow kéo dài; log cập nhật SLA mới. | Đơn `In Escrow`; buyer có lý do hợp lệ. |  |  |  |  |  |  |  |
| TC-DIS-001 | Mở tranh chấp với đầy đủ bằng chứng | 1. Buyer vào chi tiết đơn `Paid`.<br>2. Chọn "Khiếu nại".<br>3. Tải ảnh, nhập lý do. | Trạng thái `Dispute Open`; ticket tạo; seller được thông báo. | Đơn trong hạn khiếu nại; buyer đã nhận hàng. |  |  |  |  |  |  |  |
| TC-DIS-002 | Ngăn mở tranh chấp khi quá hạn | 1. Buyer cố mở tranh chấp sau 30 ngày.<br>2. Submit form. | Hệ thống báo quá hạn; không tạo dispute. | Chính sách giới hạn 30 ngày. |  |  |  |  |  |  |  |
| TC-DIS-003 | Escalate tranh chấp lên quản trị | 1. CS đánh dấu cần escalate.<br>2. Quản trị viên tiếp nhận. | Trạng thái chuyển `Dispute Escalated`; SLA mới áp dụng; thông báo tới các bên. | Dispute đang mở; CS có quyền escalate. |  |  |  |  |  |  |  |
| TC-DIS-004 | Giải quyết tranh chấp hoàn tiền một phần | 1. Admin xác nhận seller lỗi 40%.<br>2. Thực hiện partial refund. | Đơn `Dispute Resolved`; buyer nhận 40%; seller giảm doanh thu tương ứng. | Escrow/ payment hỗ trợ partial refund. |  |  |  |  |  |  |  |
| TC-DIS-005 | Từ chối tranh chấp do thiếu bằng chứng | 1. CS kiểm tra không có tài liệu chứng minh.<br>2. Chọn "Reject". | Đơn trở về trạng thái trước dispute; dispute `Rejected`; thông báo lý do. | Dispute mở nhưng không đủ chứng cứ. |  |  |  |  |  |  |  |
| TC-DIS-006 | Tự động đóng tranh chấp khi buyer không phản hồi | 1. CS yêu cầu bổ sung bằng chứng.<br>2. Buyer không phản hồi 5 ngày.<br>3. Job đóng tranh chấp. | Dispute chuyển `Auto Closed`; tiền giải phóng cho seller. | SLA auto-close cấu hình. |  |  |  |  |  |  |  |
| TC-DIS-007 | Ngăn tạo tranh chấp trùng lặp | 1. Buyer cố mở dispute lần nữa cho cùng đơn.<br>2. Gửi form. | Hệ thống báo dispute đã tồn tại; không tạo mới. | Đơn đã có dispute trạng thái mở. |  |  |  |  |  |  |  |

> Ghi chú: Các cột vòng test sẽ được cập nhật sau khi chạy test thực tế.
